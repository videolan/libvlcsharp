steps:
- task: UseDotNet@2
  displayName: 'Use .NET Core SDK'
  inputs:
    packageType: sdk
    version: 9.0.201

- bash: |
   dotnet workload install android
   dotnet workload install ios
   dotnet workload install macos
   dotnet workload install tvos
   dotnet workload install maui-android
   dotnet workload install maui-ios
  displayName: 'Install mobile workloads'
  condition: ne( variables['Agent.OS'], 'Linux' )

- task: PowerShell@2
  displayName: 'Install Xamarin Workload'
  condition: eq( variables['Agent.OS'], 'Windows_NT' )
  inputs:
    targetType: 'inline'
    script: |
      Set-Location "C:\Program Files (x86)\Microsoft Visual Studio\Installer"
      $InstallPath = "C:\Program Files\Microsoft Visual Studio\2022\Enterprise"
      $componentsToAdd = @("Component.Xamarin")
      [string]$workloadArgs = $componentsToAdd | ForEach-Object { " --add " + $_ }
      $Arguments = @('/c', "vs_installer.exe", 'modify', '--installPath', "`"$InstallPath`"", $workloadArgs, '--quiet', '--norestart', '--nocache')
      $process = Start-Process -FilePath cmd.exe -ArgumentList $Arguments -Wait -PassThru -WindowStyle Hidden
      if ($process.ExitCode -eq 0) {
        Write-Host "Xamarin components installed successfully"
      } else {
        Write-Error "Failed to install Xamarin components (exit code: $($process.ExitCode))"
        exit 1
      }

- task: DotNetCoreCLI@2
  displayName: 'Install Cake'
  inputs:
    command: custom
    custom: 'tool'
    arguments: 'install cake.tool --global'
